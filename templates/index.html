<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Worksheet Filler</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="page">
    <header class="header">
      <h1>Conor's AI Worksheet Filler</h1>
      <p class="subtitle">Upload a PDF worksheet and let the AI fill in the answers for you.</p>
    </header>

    <main class="card">
      <form
        method="post"
        action="/"
        enctype="multipart/form-data"
        class="upload-form"
        id="upload-form"
        target="download_iframe"
      >
        <label class="file-label">
          <span>Select a worksheet PDF</span>
          <input type="file" name="pdf_file" accept="application/pdf" required>
        </label>

        <button type="submit" class="btn-primary" id="submit-btn">
          Upload &amp; Fill
        </button>
      </form>

      {% if error %}
      <p class="error">{{ error }}</p>
      {% endif %}

      <p class="hint">
        Tip: Start with 1–3 page worksheets for faster results. Large files may take a bit.
      </p>

      <p class="warning">
        I am personally paying for these API tokens, please don't abuse :(
      </p>
    </main>

    <footer class="footer">
      <p>Built by Conor · Powered by OpenAI</p>
    </footer>
  </div>

  <!-- Hidden iframe to receive the file download -->
  <iframe
    id="download_iframe"
    name="download_iframe"
    style="display:none;"
  ></iframe>

  <!-- Loading overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <p class="loading-text">Filling your worksheet…</p>
  </div>

  <script>
    const form = document.getElementById('upload-form');
    const overlay = document.getElementById('loading-overlay');
    const submitBtn = document.getElementById('submit-btn');
    const iframe = document.getElementById('download_iframe');

    if (form && overlay && submitBtn && iframe) {
      form.addEventListener('submit', function () {
        overlay.classList.remove('hidden');
        submitBtn.disabled = true;
      });

      // When the iframe loads, the server has finished responding
      iframe.addEventListener('load', function () {
        overlay.classList.add('hidden');
        submitBtn.disabled = false;
      });
    }
  </script>
</body>
</html>
